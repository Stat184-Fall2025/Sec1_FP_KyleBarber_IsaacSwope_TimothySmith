---
title: "NFL_Data_Analysis"
authors: 
  - name: Isaac Swope
  - name: Kyle Barber
  - name: Tim Smith
date: "Dec 3, 2025"
date_modified: "Dec 3, 2025"
execute:
  warning: false
  error: false
  echo: false
format:
  pdf:
    geometry: margin=1in
    cap-location: top
    
---

```{r}
#| label: Packages

#Tidyverse Coding Styling


library(tidyverse)
library(ggimage)
library(kableExtra)
library(patchwork)
library(ggpubr)

```

## Data Overview

```{r}
#| label: Importing Data

NFL_raw <- read.csv("nfl-team-statistics (1).csv")

```


```{r}
#| label: Adding East, West, North and South Conferences

NFC_East_data <- NFL_raw %>%
  filter(team %in% c("DAL", "NYG", "PHI", "WAS"))%>%
  mutate(Conf = 'NFC_East')

NFC_West_data <- NFL_raw %>%
  filter(team %in% c("LA", "SEA", "SF", "ARI"))%>%
  mutate(Conf = 'NFC_West')

NFC_North_data <- NFL_raw %>%
  filter(team %in% c("CHI", "GB", "DET", "MIN"))%>%
  mutate(Conf = 'NFC_North')

NFC_South_data <- NFL_raw %>%
  filter(team %in% c("TB", "CAR", "ATL", "NO"))%>%
  mutate(Conf = 'NFC_South')

AFC_East_data <- NFL_raw %>%
  filter(team %in% c("NE", "BUF", "MIA", "NYJ"))%>%
  mutate(Conf = 'AFC_East')

AFC_West_data <- NFL_raw %>%
  filter(team %in% c("DEN", "LAC", "KC", "LV"))%>%
  mutate(Conf = 'AFC_West')

AFC_North_data <- NFL_raw %>%
  filter(team %in% c("BAL", "PIT", "CIN", "CLE"))%>%
  mutate(Conf = 'AFC_North')

AFC_South_data <- NFL_raw %>%
  filter(team %in% c("JAX", "IND", "HOU", "TEN"))%>%
  mutate(Conf = 'AFC_South')

NFL_Clean <- bind_rows(NFC_East_data, NFC_North_data, NFC_South_data, NFC_West_data, AFC_East_data, AFC_South_data, AFC_North_data, AFC_West_data) %>%
  arrange(season, team)%>%
    separate_wider_delim(
    cols = 'Conf',
    delim = '_',
    names = c('Conf', 'Div')
  )

```

## Offensive and Defensive Association with Wins

```{r, fig.height=5, fig.width=10}
#|label: fig-Win-association
#|fig-cap: "Win Association of Offensive and Defensive Pass Yards"
#| fig-subcap: 
#|   - "first"
#|   - "second"
#|   - "third"
#|   - "fourth"
#|fig-alt: "Four scatter plots showing NFL data, with axes for wins and various yard metrics. Trend lines suggest correlations."

#author: Timothy Smith
plot1<-NFL_Clean%>%
  group_by(Div)%>%
ggplot(
    mapping = aes(
      x = offense_total_yards_gained_pass,
      y = wins,
      color = Conf
    )
  ) +
  geom_point(size = 1, alpha=0.2) +
  labs(#Step 4: add labels and title to the data visualization and create the colors for the points----
    x = "Offensive Pass Yards",
    y = "Wins",
    color = "Conference",
    title = "Wins Compared to Offensive Pass Yards"
  ) +
  scale_color_manual(
    values = c("red", "blue")
  )+
  theme_bw() +
  theme(
    legend.position = "bottom"
  )+
  geom_smooth(method = "lm", se = FALSE, color = "black") 

  plot2<-NFL_Clean%>%
  group_by(Div)%>%
ggplot(
    mapping = aes(
      x = offense_total_yards_gained_run,
      y = wins,
      color = Conf
    )
  ) +
  geom_point(size=1, alpha=0.2) +
  labs(#Step 5: add labels and title to the data visualization and create the colors for the points----
    x = "Offensive Run Yards",
    y = "Wins",
    color = "Conference",
    shape = "team",
    title = "Wins Compared to Offensive Run Yards"
  ) +
  scale_color_manual(
    values = c("red", "blue")
  )+
  theme_bw() +
  theme(
    legend.position = "bottom"
  )+
  geom_smooth(method = "lm", se = FALSE, color = "black") 
  
  plot3<-NFL_Clean%>%
  group_by(Div)%>%
ggplot(
    mapping = aes(
      x = defense_total_yards_gained_pass,
      y = wins,
      color = Conf
    )
  ) +
  geom_point(size=1, alpha=0.2) +
  labs(#Step 6: add labels and title to the data visualization and create the colors for the lines----
    x = "Defensive Allowed Pass Yards",
    y = "Wins",
    color = "Conference",
    title = "Wins Compared to Defensive Allowed Pass Yards"
  ) +
  scale_color_manual(
    values = c("red", "blue")
  )+
  theme_bw() +
  theme(
    legend.position = "bottom"
  )+
  geom_smooth(method = "lm", se = FALSE, color = "black") 
  

  plot4<-NFL_Clean%>%
  group_by(Div)%>%
ggplot(
    mapping = aes(
      x = defense_total_yards_gained_run,
      y = wins,
      color = Conf
    )
  ) +
  geom_point(size=1, alpha=0.2) +
  labs(#Step 7: add labels and title to the data visualization and create the colors for the lines----
    x = "Defensive Allowed Run Yards",
    y = "Wins",
    color = "Conference",
    title = "Wins Compared to Defensive Allowed Run Yards"
  ) +
  scale_color_manual(
    values = c("red", "blue")
  )+
  theme_bw() +
  theme(
    legend.position = "bottom"
  )+
  geom_smooth(method = "lm", se = FALSE, color = "black") 
  
  ggarrange(plot1, plot2, plot3, plot4, nrow = 2, ncol = 2, common.legend = TRUE, legend = "bottom" )
  



```


```{r}
#| label: tbl-O-D-Statistics 
#|tbl-cap: "NFL Offensive and Drfensive Statistics"

NFL_O_D <- NFL_Clean %>%
  group_by(team)%>%
  summarize(
    Mean_Wins = mean(wins, na.rm = TRUE),
    Mean_O_pass_yards = mean(offense_total_yards_gained_pass, na.rm = TRUE),
    Mean_O_run_yards = mean(offense_total_yards_gained_run, na.rm = TRUE),
    Mean_D_pass_yards = mean(defense_total_yards_gained_pass, na.rm = TRUE),
    Mean_D_run_yards = mean(defense_total_yards_gained_run, na.rm = TRUE)
  ) 
    
    names(NFL_O_D) <- c(
    "Teams",
    "Average Wins",
    "Mean Offensive Pass Yards",
    "Mean Offense Run Yards",
    "Mean Defensive Pass Yards",
    "Mean Defensive Run Yards"
    )
  
NFL_O_D %>%
  kable(
    booktabs = TRUE,
    align = c("l", rep("c",10)))

```

## Team Wins from 1999-2022


```{r, fig.width=8}
#| label: fig-team-wins
#| fig-cap: "Boxplots of Team Wins"
#| fig-alt: "Grid of four barcharts showing total team wins separated by division"

#author: Isaac Swope


ggplot(NFL_Clean) +
  aes(x = fct_reorder(team, wins, .fun=sum, .desc=TRUE), y = wins, fill = Conf) +
  geom_col(color = NA) +
  facet_wrap("Div", scales = "free") + #eliminate spacing between columns due to scale
  labs(y = "Wins", 
       x = "Teams",
       )
  
```


```{r}
#| label: tbl-win-stats
#| tbl-cap: "Team Wins Statistics"
#| html-table-processing: none

#author: Isaac Swope

winsTable <- NFL_Clean %>%
  group_by(team)%>%
  summarize(
    Count=n(),
    Min = min(wins, na.rm = TRUE),
    Quartile_1 = quantile(wins, probs = 0.25, na.rm = TRUE),
    Median = median(wins, na.rm = TRUE),
    Quintile_3 = quantile(wins, probs = 0.75, na.rm = TRUE),
    Max = max(wins, na.rm = TRUE),
    Mean = mean(wins, na.rm = TRUE),
    SD = sd(wins, na.rm = TRUE),
  )%>%
  mutate(
    across(
      .cols = where(is.numeric),
      .fns = ~round(.x, digits = 2)
    )
  )

names(winsTable) <- c(
    "Team",
    "Seasons",
    "Minimum",
    "Quartile 1",
    "Median",
    "Quartile 3",
    "Max",
    "Mean",
    "SD"
    )
  
winsTable %>%
  kable(
    booktabs = TRUE,
    align = c("l", rep("c",10))
  )

```

## Team Efficiency


```{r}
#| label: fig-efficiency-scatter-plot
#| fig-cap: "NFL Team Efficiency Scatter Plot"
#| fig-alt: "Scatter plot of all NFL teams average points scored vs points allowed with effeciency line."
#| fig-pos: "H"

#Author: Kyle Barber

NFL_Clean_3 <- NFL_Clean %>% ## Wrangle data
  select(team, Conf, score_differential, points_scored,
         points_allowed, wins, losses) %>% ### Choose necessary columns
  group_by(team, Conf) %>%
  summarise(
    points_scored = mean(points_scored),
    points_allowed = mean(points_allowed),
    wins = mean(wins),
    losses = mean(losses),
    point_differential = mean(score_differential),
    .groups = "drop"
  ) ### Get the mean for each variable
NFL_Clean_3$logo <- paste0("Logos/", NFL_Clean_3$team, ".png") ### Add logo column

ggplot(NFL_Clean_3) + ## Make plot
  aes(x = points_allowed, y = points_scored) + ### Set aesthetic
  geom_point(size = 0.1) + ### Make scatter plot
  geom_image(aes(image = logo)) + ### add in images
  labs(
    x = "Points Allowed (per season)",
    y = "Points Scored (per season)"
  ) + ### Set x and y axis labels
  geom_abline(slope = 1, intercept = 0) + ### Add effeciency line
  theme_minimal() +
  facet_wrap(vars(Conf)) ### Separate plots by confrence

```

@fig-efficiency-scatter-plot shows a scatter plot of each NFL team's efficiency by showing the relationship between a team's average points allowed per season (x-axis) vs average points scored per season (y-axis) from the 1999 NFL regular season to the 2022 NFL regular season. Each point on the graph represents an individual team average and differentiates the teams by team logo. The top left corner of the plot shows the most efficient teams. The bottom right corner of the plot shows the least efficient teams. The diagonal line in the middle of both plots demonstrates a efficiency threshold. If a team is above the line they are considered efficient. If a team is below the line they are considered inefficient. If a team is on the line they are neutral. The plot is broken up into two sides, one representing the AFC teams and the other representing the NFC teams. 

```{r}
#| label: tbl-efficiency-AFC
#| tbl-cap: "AFC Efficiency Table"
#| tbl-alt: "Data table showing all AFC team's logo, average point differential, win rate, and loss rate."
#| tbl-pos: "H"

#Author: Kyle Barber
  
AFC_table <- NFL_Clean_3%>% ## Clean data
  filter(Conf == 'AFC')%>% ### Choose necessary confrence
  select(team, point_differential, wins, losses, logo)%>% ### Choose necessary variables
  mutate(
    point_differential = round(point_differential, digits = 4),
    wins = round(wins, digits = 4),
    losses = round(losses, digits = 4),
    image = ""
  )%>% ### Round all numeric variables
  arrange(desc(wins)) %>% ### Arrange by descending win rate
  rename( ### Rename variables
    Team = team,
    `Average Point Differential` = point_differential,
    `Win Rate` = wins,
    `Loss Rate` = losses
  )

AFC_table %>% ## Make table
  select(Team, image, `Average Point Differential`, `Win Rate`, `Loss Rate`) %>%### Choose necessary variables to include
  kable( ### Set format
    booktabs = TRUE,
    align = c("l", rep("c", 10)),
    format = "latex"
  )%>%
  kable_paper()%>%
  column_spec(2, image = spec_image(path = AFC_table$logo, 50, 50)) ### Add images

```

@tbl-efficiency-AFC shows a data table where the case is an individual AFC team. The variable include team, logo, average point differential, win rate and loss rate. All variables and statistics were calculated from the 1999 NFL regular season to the 2022 NFL regular season. 

```{r}
#| label: tbl-efficiency-NFC
#| tbl-cap: "NFC Efficiency Table"
#| tbl-alt: "Data table showing all NFC team's logo, average point differential, win rate, and loss rate."
#| tbl-pos: "H"

#Author: Kyle Barber

NFC_table <- NFL_Clean_3%>% ## Clean data
  filter(Conf == 'NFC')%>% ### Choose necessary confrence
  select(team, point_differential, wins, losses, logo)%>% ### Choose necessary variables
  mutate( ### round each numeric variable
    point_differential = round(point_differential, digits = 4),
    wins = round(wins, digits = 4),
    losses = round(losses, digits = 4),
    image = ""
  )%>%
  arrange(desc(wins)) %>% ### Arrange by win rate descending
  rename( ### Rename variables
    Team = team,
    `Average Point Differential` = point_differential,
    `Win Rate` = wins,
    `Loss Rate` = losses
  )

NFC_table %>% ## Make table
  select(Team, image, `Average Point Differential`, `Win Rate`, `Loss Rate`) %>% ### select necessary variables
  kable( ### Set format
    booktabs = TRUE,
    align = c("l", rep("c", 10)),
    format = "latex"
  )%>%
  kable_paper()%>%
  column_spec(2, image = spec_image(path = NFC_table$logo, 50, 50)) ### Add images

```

@tbl-efficiency-NFC shows a data table where the case is an individual NFC team. The variable include team, logo, average point differential, win rate and loss rate. All variables and statistics were calculated from the 1999 NFL regular season to the 2022 NFL regular season. 

{{< pagebreak >}}
#Code Appendix
``` {r codeAppend, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```
